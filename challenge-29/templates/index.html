<!doctype html>
<html>
<body>

<h2>Create invoice</h2>

<input id="customer" placeholder="customer name">
<input id="address" placeholder="billing address">
<input id="vat" placeholder="VAT ID">
<input id="desc" placeholder="description">
<button id="createBtn">Create</button>

<h2>Invoices</h2>
<ul id="list"></ul>

<script>
async function create() {
  await fetch("/invoices", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      customer_name: customer.value,
      billing_address: address.value,
      vat_id: vat.value,
      description: desc.value
    })
  });

  customer.value = address.value = vat.value = desc.value = "";
  load();
}

async function pay(id) {
  await fetch(`/pay/${id}`, { method: "POST" });
  load();
}

function addText(el, text) {
  el.appendChild(document.createTextNode(text));
}

async function load() {
  const data = await (await fetch("/invoices")).json();
  list.textContent = "";

  data.forEach(i => {
    const li = document.createElement("li");

    addText(
      li,
      `#${i.id} ${i.customer_name} amount=${i.amount} paid=${i.paid} `
    );

    if (!i.paid) {
      const b = document.createElement("button");
      b.textContent = "pay";
      b.addEventListener("click", () => pay(i.id));
      li.appendChild(b);
    }

    list.appendChild(li);
  });
}

createBtn.addEventListener("click", create);
load();
</script>

</body>
</html>
